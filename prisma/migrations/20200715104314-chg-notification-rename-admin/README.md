# Migration `20200715104314-chg-notification-rename-admin`

This migration has been generated by rahuldamodar94 at 7/15/2020, 10:43:14 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."admins" (
"active" boolean   DEFAULT true,"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"password" text  NOT NULL ,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"username" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."notifications" (
"active" boolean  NOT NULL DEFAULT true,"bid_id" integer   ,"buyer_id" integer  NOT NULL ,"created" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"message" text  NOT NULL ,"order_id" integer  NOT NULL ,"read" boolean  NOT NULL DEFAULT true,"seller_id" integer  NOT NULL ,"updated" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"usersId" integer   ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."notificatons" DROP CONSTRAINT IF EXiSTS "notificatons_bid_id_fkey";

ALTER TABLE "public"."notificatons" DROP CONSTRAINT IF EXiSTS "notificatons_order_id_fkey";

CREATE UNIQUE INDEX "admins.username" ON "public"."admins"("username")

ALTER TABLE "public"."notifications" ADD FOREIGN KEY ("buyer_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."notifications" ADD FOREIGN KEY ("seller_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."notifications" ADD FOREIGN KEY ("order_id")REFERENCES "public"."orders"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."notifications" ADD FOREIGN KEY ("bid_id")REFERENCES "public"."bids"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."notifications" ADD FOREIGN KEY ("usersId")REFERENCES "public"."users"("id") ON DELETE SET NULL  ON UPDATE CASCADE

DROP TABLE "public"."admin";

DROP TABLE "public"."notificatons";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200715101944-chg-notification-schema..20200715104314-chg-notification-rename-admin
--- datamodel.dml
+++ datamodel.dml
@@ -3,23 +3,23 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model bids {
-  active       Boolean?       @default(true)
-  created      DateTime       @default(now())
-  id           Int            @default(autoincrement()) @id
-  orders_id    Int
-  price        String
-  status       Int?           @default(0)
-  updated      DateTime       @default(now())
-  users_id     Int
-  orders       orders         @relation(fields: [orders_id], references: [id])
-  users        users          @relation(fields: [users_id], references: [id])
-  notificatons notificatons[]
+  active        Boolean?        @default(true)
+  created       DateTime        @default(now())
+  id            Int             @default(autoincrement()) @id
+  orders_id     Int
+  price         String
+  status        Int?            @default(0)
+  updated       DateTime        @default(now())
+  users_id      Int
+  orders        orders          @relation(fields: [orders_id], references: [id])
+  users         users           @relation(fields: [users_id], references: [id])
+  notifications notifications[]
 }
 model categories {
   active              Boolean?              @default(true)
@@ -82,67 +82,76 @@
   users    users    @relation(fields: [users_id], references: [id])
 }
 model orders {
-  active         Boolean?       @default(true)
+  active         Boolean?        @default(true)
   chain_id       String
   categories_id  Int
-  created        DateTime       @default(now())
+  created        DateTime        @default(now())
   erc20tokens_id Int
   expiry_date    DateTime?
-  id             Int            @default(autoincrement()) @id
+  id             Int             @default(autoincrement()) @id
   maker_address  Int
   min_price      String
   price          String
   signature      String?
-  status         Int?           @default(0)
+  status         Int?            @default(0)
   taker_address  Int?
   taker_amount   String?
   tokens_id      String
   txhash         String?
   type           String
-  updated        DateTime       @default(now())
-  views          Int?           @default(0)
-  categories     categories     @relation(fields: [categories_id], references: [id])
-  erc20tokens    erc20tokens    @relation(fields: [erc20tokens_id], references: [id])
-  maker_users    users          @relation("maker_orders", fields: [maker_address], references: [id])
-  taker_users    users?         @relation("taker_orders", fields: [taker_address], references: [id])
+  updated        DateTime        @default(now())
+  views          Int?            @default(0)
+  categories     categories      @relation(fields: [categories_id], references: [id])
+  erc20tokens    erc20tokens     @relation(fields: [erc20tokens_id], references: [id])
+  maker_users    users           @relation("maker_orders", fields: [maker_address], references: [id])
+  taker_users    users?          @relation("taker_orders", fields: [taker_address], references: [id])
   bids           bids[]
-  notificatons   notificatons[]
+  notifications  notifications[]
   favourites     favourites[]
 }
 model users {
-  active       Boolean?               @default(true)
-  address      String                 @unique
-  created      DateTime               @default(now())
-  id           Int                    @default(autoincrement()) @id
-  updated      DateTime               @default(now())
-  bids         bids[]
-  favourites   favourites[]
-  maker_orders orders[]               @relation("maker_orders")
-  taker_orders orders[]               @relation("taker_orders")
-  approved     erc20tokensaddresses[]
-  erc20tokens  erc20tokens[]
+  active              Boolean?               @default(true)
+  address             String                 @unique
+  created             DateTime               @default(now())
+  id                  Int                    @default(autoincrement()) @id
+  updated             DateTime               @default(now())
+  bids                bids[]
+  favourites          favourites[]
+  maker_orders        orders[]               @relation("maker_orders")
+  taker_orders        orders[]               @relation("taker_orders")
+  maker_notifications notifications[]        @relation("buyer_notifications")
+  taker_notifications notifications[]        @relation("seller_notifications")
+  approved            erc20tokensaddresses[]
+  erc20tokens         erc20tokens[]
+  notifications       notifications[]
 }
-model admin {
+model admins {
   active   Boolean? @default(true)
   username String   @unique
   password String
   created  DateTime @default(now())
   id       Int      @default(autoincrement()) @id
   updated  DateTime @default(now())
 }
-model notificatons {
-  read     Boolean  @default(true)
-  active   Boolean  @default(true)
-  created  DateTime @default(now())
-  id       Int      @default(autoincrement()) @id
-  message  String
-  updated  DateTime @default(now())
-  order_id Int
-  orders   orders   @relation(fields: [order_id], references: [id])
-  bid_id   Int?
-  bids     bids?    @relation(fields: [bid_id], references: [id])
+model notifications {
+  read      Boolean  @default(true)
+  active    Boolean  @default(true)
+  created   DateTime @default(now())
+  id        Int      @default(autoincrement()) @id
+  message   String
+  buyer_id  Int
+  buyers    users    @relation("buyer_notifications", fields: [buyer_id], references: [id])
+  seller_id Int
+  sellers   users    @relation("seller_notifications", fields: [seller_id], references: [id])
+  updated   DateTime @default(now())
+  order_id  Int
+  orders    orders   @relation(fields: [order_id], references: [id])
+  bid_id    Int?
+  bids      bids?    @relation(fields: [bid_id], references: [id])
+  users     users?   @relation(fields: [usersId], references: [id])
+  usersId   Int?
 }
```


