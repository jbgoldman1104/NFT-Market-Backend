# Migration `20200617113745-removed-token-logic`

This migration has been generated by rahul at 6/17/2020, 11:37:45 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."favourites" DROP CONSTRAINT IF EXiSTS "favourites_tokens_id_fkey",
DROP COLUMN "tokens_id",
ADD COLUMN "order_id" integer  NOT NULL ;

ALTER TABLE "public"."orders" DROP CONSTRAINT IF EXiSTS "orders_tokens_id_fkey",
ALTER COLUMN "tokens_id" SET DATA TYPE text ;

ALTER TABLE "public"."tokens" DROP CONSTRAINT IF EXiSTS "tokens_categories_id_fkey";

ALTER TABLE "public"."tokens" DROP CONSTRAINT IF EXiSTS "tokens_users_id_fkey";

ALTER TABLE "public"."favourites" ADD FOREIGN KEY ("order_id")REFERENCES "public"."orders"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."tokens";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200616222407-schema-name-correction..20200617113745-removed-token-logic
--- datamodel.dml
+++ datamodel.dml
@@ -31,9 +31,8 @@
   updated             DateTime              @default(now())
   url                 String?
   categoriesaddresses categoriesaddresses[]
   orders              orders[]
-  tokens              tokens[]
 }
 model categoriesaddresses {
   active        Boolean?   @default(true)
@@ -75,12 +74,12 @@
 model favourites {
   created   DateTime @default(now())
   id        Int      @default(autoincrement()) @id
-  tokens_id Int
+  order_id  Int
   updated   DateTime @default(now())
   users_id  Int
-  tokens    tokens   @relation(fields: [tokens_id], references: [id])
+  orders    orders   @relation(fields: [order_id], references: [id])
   users     users    @relation(fields: [users_id], references: [id])
 }
 model orders {
@@ -97,42 +96,21 @@
   signature      String?
   status         Int?           @default(0)
   taker_address  Int?
   taker_amount   String?
-  tokens_id      Int
+  tokens_id      String
   txhash         String?
   type           String
   updated        DateTime       @default(now())
   views          Int?           @default(0)
   categories     categories     @relation(fields: [categories_id], references: [id])
   erc20tokens    erc20tokens    @relation(fields: [erc20tokens_id], references: [id])
   maker_users    users          @relation("maker_orders", fields: [maker_address], references: [id])
   taker_users    users?         @relation("taker_orders", fields: [taker_address], references: [id])
-  tokens         tokens         @relation(fields: [tokens_id], references: [id])
   bids           bids[]
   notificatons   notificatons[]
 }
-model tokens {
-  active        Boolean?     @default(true)
-  categories_id Int
-  created       DateTime     @default(now())
-  description   String?
-  id            Int          @default(autoincrement()) @unique
-  img_url       String?
-  metadata      Json?
-  token_id      String
-  name          String
-  updated       DateTime     @default(now())
-  users_id      Int
-  categories    categories   @relation(fields: [categories_id], references: [id])
-  users         users        @relation(fields: [users_id], references: [id])
-  favourites    favourites[]
-  orders        orders[]
-
-  @@id([token_id, categories_id])
-}
-
 model users {
   active       Boolean?               @default(true)
   address      String                 @unique
   created      DateTime               @default(now())
@@ -141,9 +119,8 @@
   bids         bids[]
   favourites   favourites[]
   maker_orders orders[]               @relation("maker_orders")
   taker_orders orders[]               @relation("taker_orders")
-  tokens       tokens[]
   approved     erc20tokensaddresses[]
   erc20tokens  erc20tokens[]
 }
```


